# bump git short revision into a version displayed as batch in the page title

# chats response
Added a git short revision badge next to the report title and wired it into the report context, plus a new ATDD check to keep it covered. The badge renders as v<short-hash> and falls back to unknown if git canâ€™t resolve the revision.

Details:

src/report-generator.ts now reads rev-parse --short HEAD and renders a version-badge in the <h1>.
tests/acceptance/report-output.spec.ts includes a new scenario; tests/dsl/ci-report.dsl.ts and tests/driver/report-session.ts expose the revision for assertions.
Updated the fake git shim to support rev-parse --short in tests/driver/report-session.ts.
Tests: npm run test

If you want, I can also add the revision to the HTML <title> tag for browser tabs.

4 files changed
+63
-3
Undo

Review
report-generator.ts
+31
-1
report-output.spec.ts
+9
-0
report-session.ts
+14
-2
ci-report.dsl.ts
+9
-0

# please add also the version from package.json into the version badge, postfixed with the git short revision.
- also during a build, the patch version in package.json should be incremented.

# chats response
Added package version to the title badge (now v{packageVersion}+{gitShort}) and made the build bump the patch version. Also added ATDD coverage for both.

Details:

Badge now includes package.json version plus git short revision. src/report-generator.ts
Build script now runs npm version patch --no-git-tag-version before compile and SBOM. package.json
New ATDD checks for build version bump and badge version. tests/acceptance/sbom.spec.ts, tests/acceptance/report-output.spec.ts, tests/dsl/ci-report.dsl.ts
Tests: npm run test

Next steps (optional):

If you want the browser tab title to include the same version string, I can add it to the <title> tag too.
5 files changed
+52
-2
Undo

Review
package.json
+1
-1
report-generator.ts
+18
-1
report-output.spec.ts
+2
-0
sbom.spec.ts
+7
-0
ci-report.dsl.ts
+24
-0

# error on global npm install
```
sudo npm install -g .
npm error code 254
npm error path /Users/steell/dev/is-this-ci
npm error command failed
npm error command sh -c npm run build
npm error > is-this-ci@0.1.2 build
npm error > npm version patch --no-git-tag-version && tsc -p tsconfig.json && npm run sbom
npm error npm error code ENOENT
npm error npm error syscall open
npm error npm error path /usr/local/package.json
npm error npm error errno -2
npm error npm error enoent ENOENT: no such file or directory, open '/usr/local/package.json'
npm error npm error enoent This is related to npm not being able to find a file.
npm error npm error enoent
npm error npm error A complete log of this run can be found in: /Users/steell/.npm/_logs/2025-12-18T13_36_03_143Z-debug-0.log
npm error A complete log of this run can be found in: /Users/steell/.npm/_logs/2025-12-18T13_36_02_934Z-debug-0.log
```
Bumping the version only in a local 'npm install' instead of the global should be necessary.

# chats response
Updated the build to bump the patch version only for local installs and skip bumping on global installs, and adjusted tests accordingly.

Details:

Build now runs node scripts/bump-version.js before compile/SBOM. package.json
New scripts/bump-version.js increments patch version in package.json, but exits early when npm_config_global=true or IS_THIS_CI_SKIP_VERSION_BUMP=true. scripts/bump-version.js
ATDD updated to require the bump script and verify it skips global installs. tests/acceptance/sbom.spec.ts, tests/dsl/ci-report.dsl.ts
Tests: npm run test

If you want the global install to still bump in a different file (like dist/version.json) instead of package.json, I can switch it.

4 files changed
+39
-6
Undo

Review
package.json
+1
-1
bump-version.js
+25
-0
sbom.spec.ts
+3
-2
ci-report.dsl.ts
+10
-3
